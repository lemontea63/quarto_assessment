---
title: "Quarto Assessment MT24"
format: html
editor: visual
---

#Introduction
This analysis aims to assess the impact of drought on beak morphology in the medium ground finch (Geospiza fortis), found in the Galapagos islands. Beak morphology is intricately linked to food availability, with beaks adapting to certain sets of food sources which are available within the niche of a certain species. Freak events like droughts or floods create large selection pressures which act on beak morphology as they impact food availability; these sorts of events may prevent many plant species which are not tolerant to stresses from setting seed, or some plants may even die which will limit food availability in a particular year. To overcome these selection pressures, animals such as birds will evolve to become better adapted to the changed environment, for example by evolving larger, tougher beaks which can take advantage of remaining food sources.

```{r}
#Loading packages needed for this analysis.
library(Sleuth3) 
library(ggplot2) 
library(tinytex) 
library(arm) 
library(rmarkdown)
library(here)
library(renv)
library(dplyr)
library(multcompView)
```
```{r}
#Investigating data.
head(case0201)
str(case0201)
summary(case0201)
colnames(case0201)

#Preserving raw data as .csv file to keep it safe in event of mutation.
write.csv(case0201, here("data/finches_raw.csv"))
finches_raw <- read.csv(here("data/finches_raw.csv"))

#Attempting to factorise Year variable.
finches_raw$Year = as.factor(finches_raw$Year)
str(finches_raw)

#Histograms to check spread of data- transformations unsuccessful so will simply use untransformed data.
ggplot(data = finches_raw, aes(x = Depth)) + geom_histogram()
log_depth <- log10(finches_raw$Depth)
ggplot(data = finches_raw, aes(x = log_depth)) + geom_histogram()
sqrt_depth <- sqrt(finches_raw$Depth)
ggplot(data = finches_raw, aes(x = sqrt_depth)) + geom_histogram()
         
#Plotting boxplot to see what data look like...
finches_exploratory_figure <- ggplot(data = finches_raw, aes(x=Year, y=Depth, group = Year)) + geom_boxplot(aes(color = Year)) + geom_jitter(aes(color = Year), alpha = 0.3, position = position_jitter(width = 0.2, seed=0)) + labs (x= "Year", y = "Depth (cm)")
finches_exploratory_figure

```
#Methods
To analyse the difference in beak depth between 1976 and 1978, an ANOVA test will be conducted. This is because there are two distinct populations, and there is a continuous response variable and a categorical explanatory variable. 

The null hypothesis is that the mean difference in beak depth between years is equal to 0.

The alternative hypothesis is that the mean difference in beak depth between years is not equal to 0.

```{r Statistical analysis using lm function}

finches_model <- lm(Depth ~ Year, data = finches_raw)
plot(finches_model, which=2)
plot(finches_model, which=1)

summary(finches_model)

finch_anova <- aov(finches_model)
summary(finch_anova)
finch_tukey <- TukeyHSD(finch_anova)
print(finch_tukey)

finch_cld <- multcompLetters4(finch_anova, finch_tukey)
print(finch_cld)

finch_analysed <- group_by(finches_raw, Year) %>% 
  summarise(mean = mean(Depth), quant = quantile(Depth, probs = 0.75)) %>% 
  arrange(desc(mean))

finch_cld <- as.data.frame.list(finch_cld$Year)
finch_analysed$cld <- finch_cld$Letters

print(finch_analysed)
```

#Results

```{r}

finches_results_figure <- ggplot(data = finches_raw, aes(x=Year, y=Depth, group = Year)) + geom_boxplot(aes(color = Year)) + geom_jitter(aes(color = Year), alpha = 0.3, position = position_jitter(width = 0.2, seed=0)) + labs (x= "Year", y = "Depth (cm)") + geom_text(data = finch_analysed, aes(x=Year, y= quant, label = cld), size = 5, vjust = -1, hjust = -6)
finches_results_figure

```

#Conclusion